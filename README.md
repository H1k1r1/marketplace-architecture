# Архитектура маркетплейса(C4 Model)

## Структура
```
marketplace-architecture/
├── README.md
├── RUN.md
├── docker-compose.yml
├── services/
│   ├── product-service/
│   │   ├── app.py
│   │   ├── Dockerfile
│   │   └── requirements.txt
│   └── user-service/
│       ├── app.py
│       ├── Dockerfile
│       └── requirements.txt
└── diagrams/
    └── C4-Container-Diagram.md
```
## Описание + обоснования

## Домены + ответственность

### 1. Домен: Товары и Каталог
- Ответственность: Управление товарами, категориями, каталогом
- Владеет данными: Товары, категории, характеристики товаров
- Сервисы: Product Service

### 2. Домен: Пользователи и Продавцы
- Ответственность: Управление пользователями, аутентификация, авторизация
- Владеет: Профили пользователей, роли, учетные данные
- Сервисы: User Service

### 3. Домен: Заказы и Платежи
- Ответственность: Оформление заказов, расчет платежей
- Владеет данными: Заказы, транзакции, статусы
- Сервисы: Order Service и Payment Service

### 4. Домен: Персонализация и Рекомендации
- Ответственность: Персонализированная выдача товаров
- Владеет данными: Предпочтения пользователей, история просмотров
- Сервисы: Recommendation Service

### 5. Домен: Уведомления
- Ответственность: Отправка уведомлений о статусах заказов
- Владеет данными: Шаблоны уведомлений, история отправок
- Сервисы: Notification Service

## Распределение по сервисам

| Сервис | Домены | Логика разбиения |
|--------|--------|------------------|
| Product Service | Товары и Каталог | Изолированное управление товарной базой |
| User Service | Пользователи и Продавцы | Централизованное управление пользователями |
| Order Service | Заказы и Платежи | Отдельная обработка заказов |
| Payment Service | Заказы и Платежи | Безопасная обработка платежей |
| Recommendation Service | Персонализация и Рекомендации | Машинное обучение и аналитика |
| Notification Service | Уведомления | Асинхронная отправка сообщений |

## Границы владения данными

### Product Service
- Владеет: Бд товаров (PostgreSQL)
- Отвечает: создание, редактирование, удаление товаров
- Взаимодействия: 
  - Синхронно: с User Service для проверки прав продавца
  - Асинхронно: с Recommendation Service через события

### User Service
- Владеет: Бд пользователей (PostgreSQL)
- Отвечает: регистрация, аутентификация, управление профилями
- Взаимодействия:
  - Синхронно: с другими сервисами для проверки прав

### Order Service
- Владеет: Бд заказов (PostgreSQL)
- Отвечает: создание и управление заказами
- Взаимодействия:
  - Синхронно: с Product Service для проверки наличия товаров
  - Синхронно: с Payment Service для обработки платежей
  - Асинхронно: с Notification Service через события

### Payment Service
- Владеет: Бд платежей (PostgreSQL)
- Отвечает: обработка и учет платежей
- Взаимодействия:
  - Синхронно: с внешними платежными системами
  - Синхронно: с Order Service для подтверждения оплаты

### Recommendation Service
- Владеет: Бд рекомендаций (PostgreSQL)
- Отвечает: персонализированная выдача товаров
- Взаимодействия:
  - Асинхронно: получает события о действиях пользователей
  - Синхронно: предоставляет рекомендации другим сервисам

### Notification Service
- Владеет: Бд уведомлений (PostgreSQL)
- Отвечает: отправка уведомлений
- Взаимодействия:
  - Асинхронно: получает события о статусах заказов
  - Асинхронно: отправляет уведомления через различные каналы

## Альтернативные варианты декомпозиции

### Вариант 1: Монолитная архитектура
Плюсы:
- Простота разработки и деплоя
- Единая база данных
- Простая отладка

Минусы:
- Сложность масштабирования
- Высокая связанность компонентов
- Трудности с независимым деплоем

### Вариант 2: Микросервисная архитектура (которую использую)
Плюсы:
- Независимое масштабирование сервисов
- Изоляция сбоев
- Гибкость в выборе технологий
- Независимый деплой

Минусы:
- Сложность распределенной системы
- Необходимость управления сетевыми взаимодействиями
- Повышенная сложность отладки

### Вариант 3: Сервис-ориентированная архитектура (SOA)
Плюсы:
- Баланс между монолитом и микросервисами
- Переиспользование сервисов
- Централизованное управление

Минусы:
- Более высокая связанность чем в микросервисах
- Сложность в управлении сервисами
- Меньшая гибкость

## Trade-off'ы

### Монолитная архитектура
- Простота разработки против сложности масштабирования
- Единая бд против изоляции данных
- Простая отладка против высокой связанности

### Микросервисная архитектура
- Независимое масштабирование против сложности сети
- Изоляция сбоев против сложности отладки
- Гибкость технологий против управления распределенностью

### SOA
- Баланс сложности против меньшей гибкости
- Переиспользование против более высокой связанности
- Централизация против меньшей независимости

## Обоснование финального выбора:

Почему выбрал микросервисную архитектуру:

1. Маркетплейс требует независимого масштабирования разных компонентов (каталог товаров, система рекомендаций, платежи)

2. Критически важные компоненты (платежи, заказы) должны быть изолированы от менее критичных (рекомендации)

3. Разные домены требуют разных технологий (SQL для транзакций, NoSQL для рекомендаций)

4. Возможность обновлять отдельные компоненты без остановки всей системы

5. Микросервисная архитектура лучше всего соответствует требованиям к разделению ответственности и управлению данными
